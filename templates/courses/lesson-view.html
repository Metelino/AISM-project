{% extends "base.html" %}
{% load static %}
{% load bulma_tags %}


{% block content %}
<section class="hero is-info is-small block">
    <div class="hero-body is-flex">
        <div class='container has-text-centered'>
            <p class="title is-4">
                Lekcja : {{ lesson.name }}
            </p>
            <p class="subtitle is-6">
                Przejrzyj dostępne materiały
            </p>
        </div>
        {% if user.is_staff %}
        <nav class="navbar">
            <div class="container">
                <div id="navbarMenuHeroA" class="navbar-menu">
                    <div class="navbar-end">
                    <a class="navbar-item is-active">
                        Widok Studenta
                    </a>
                    <a class="navbar-item" href="{% url 'courses:node_edit' lesson.pk %}">
                        Widok Nauczyciela
                    </a>
                    </div>
                </div>
            </div>
        </nav>
        {% endif %}
    </div>
    <div class="hero-foot">
        <div class='container'>
            <nav id='tabs-nav' class='tabs is-boxed is-fullwidth is-small'>
                <ul>
                    <li class="is-active" onclick="openTab(event,'content-tab')">
                        <a>Treść</a>
                    </li>
                    <li onclick="openTab(event,'files-tab')">
                        <a>Pliki</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>

<div id='tabs-container' style='flex-grow:1; display:flex; flex-direction: column;'>
    <div id='files-tab' class='columns' style='flex-grow:1; display:none;'>
        <div class='column'>
            <iframe class='box' id='media-player' style='width:100%; height:100%;'>
            </iframe>
        </div>
        <div class='column is-2'>
            {% if not user.is_staff %}
            <div class='box'>
                {% if lesson in user.profile.nodes_passed.all %}
                <input data-url="{% url 'courses:lesson_passed' lesson.pk %}" type='checkbox' disabled checked>
                {% else %}
                <input data-url="{% url 'courses:lesson_passed' lesson.pk %}" onclick="pass_lesson(event)" type='checkbox'>
                {% endif %}
                <span><strong>Zalicz lekcję</strong></span> 
            </div>
            {% else %}
            <div class='box'>
                <form id='learning-form' method='POST' data-file-url="{% url 'courses:lesson_files' lesson.pk %}" action="{% url 'accounts:change_learning' %}">
                    {% csrf_token %}
                    {{ l_form|bulma }}
                    <!-- <div class=field>
                        <div class='label'>
                            {{l_form.learning_type.label_tag}}
                        </div>
                        <div class='control'>
                            {{l_form.learning_type}}
                        </div>
                    </div> -->
                </form>
            </div>
            {% endif %}
            <div id='file-list'>
                {% include 'courses/__files.html' %}
            </div>
        </div>
    </div>
    <div id='content-tab' class='content box' style='flex-direction: column;'>
        {{ lesson.content|safe }}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src='{% static "js/lesson-view.js" %}'></script>
{% endblock %}
